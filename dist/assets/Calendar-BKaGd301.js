import{r as x,j as t,a as O}from"./index-D8mHM_0A.js";import{P as E}from"./Protected-BdHEd5Ge.js";import{G as A}from"./GlassCard-CQsUbita.js";function P(d,r){const f=(new Date(d,r,1).getDay()+6)%7,l=new Date(d,r+1,0).getDate(),m=new Date(d,r,0).getDate(),u=[];for(let n=0;n<42;n++){const v=n<f?m-f+1+n:n-f+1,w=n>=f&&v<=l,y=new Date(d,r+(w?0:n<f?-1:1),v),g=y.toISOString().slice(0,10);u.push({date:y,iso:g,inMonth:w})}return u}function C({value:d,onChange:r,countersByDate:h={},year:f,month:l,setYear:m,setMonth:u,compact:n=!1,mode:v="month"}){const w=x.useMemo(()=>{if(v==="week"){const i=d||new Date(f,l,1),c=new Date(i),o=(c.getDay()+6)%7;c.setDate(c.getDate()-o);const b=[];for(let j=0;j<7;j++){const e=new Date(c);e.setDate(c.getDate()+j);const a=e.toISOString().slice(0,10);b.push({date:e,iso:a,inMonth:e.getMonth()===l})}return b}return P(f,l)},[f,l,v,d]),y=new Date().toISOString().slice(0,10),g=d?d.toISOString().slice(0,10):null,S=x.useRef(null);x.useEffect(()=>{const i=S.current;if(!i)return;function c(o){const b=Array.from(i.querySelectorAll('[role="gridcell"]')),j=i.querySelector('[tabindex="0"]'),e=b.indexOf(j),a=s=>{const I=b[e+s];I&&(I.focus(),I.click())};switch(o.key){case"ArrowLeft":o.preventDefault(),a(-1);break;case"ArrowRight":o.preventDefault(),a(1);break;case"ArrowUp":o.preventDefault(),a(-7);break;case"ArrowDown":o.preventDefault(),a(7);break;case"Home":o.preventDefault(),u(s=>(s+11)%12),m(s=>s-(l===0?1:0));break;case"End":o.preventDefault(),u(s=>(s+1)%12),m(s=>s+(l===11?1:0));break;case"PageUp":o.preventDefault(),u(s=>(s+11)%12),l===0&&m(s=>s-1);break;case"PageDown":o.preventDefault(),u(s=>(s+1)%12),l===11&&m(s=>s+1);break;case"t":case"T":{o.preventDefault();const s=new Date;r==null||r(s),m(s.getFullYear()),u(s.getMonth())}break}}return i.addEventListener("keydown",c),()=>i.removeEventListener("keydown",c)},[l,u,m,r]);const k=["–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±","–í—Å"],p=v==="week"?n?"auto-rows-[minmax(80px,1fr)]":"auto-rows-[minmax(120px,1fr)]":n?"auto-rows-[minmax(56px,1fr)]":"auto-rows-[minmax(88px,1fr)]",M=n?"gap-1":"gap-2 sm:gap-3",$=n?"text-xs sm:text-sm font-medium":"text-sm sm:text-base font-medium",D=n?"p-1.5":"p-2 sm:p-3";return t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:`grid grid-cols-7 text-center ${n?"text-[11px]":"text-xs sm:text-sm"} text-white/60`,children:k.map(i=>t.jsx("div",{className:"py-2",children:i},i))}),t.jsx("div",{ref:S,role:"grid","aria-label":"–ö–∞–ª–µ–Ω–¥–∞—Ä—å",className:`grid grid-cols-7 ${p} ${M}`,children:w.map(({date:i,iso:c,inMonth:o},b)=>{const j=c===y,e=c===g,a=h[c]||{},s=(a.notes||0)+(a.files||0)>0;return t.jsxs("button",{role:"gridcell",tabIndex:e?0:-1,onClick:()=>r==null?void 0:r(i),"aria-selected":e,className:["group relative rounded-xl text-left transition focus-ring",D,"bg-white/[.04] hover:bg-white/[.06]","border border-white/10 hover:border-white/15",!o&&"opacity-50",e&&"ring-2 ring-accent-400/70 border-transparent"].filter(Boolean).join(" "),children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsx("span",{className:$,children:i.getDate()}),j&&(n?t.jsx("span",{className:"mt-0.5 mr-0.5 inline-block size-2 rounded-full bg-accent-400/80","aria-label":"–°–µ–≥–æ–¥–Ω—è"}):t.jsx("span",{className:"px-2 py-0.5 rounded-full text-[10px] sm:text-xs bg-accent-600/30 text-accent-100",children:"–°–µ–≥–æ–¥–Ω—è"}))]}),s&&t.jsxs("div",{className:`absolute ${n?"bottom-1 left-1":"bottom-2 left-2"} flex ${n?"gap-0.5":"gap-1"}`,children:[a.notes>0&&t.jsxs("span",{className:`${n?"px-1 text-[9px]":"px-1.5 text-[10px]"} py-0.5 rounded-md bg-emerald-400/20 text-emerald-100`,children:[a.notes,"üìù"]}),a.files>0&&t.jsxs("span",{className:`${n?"px-1 text-[9px]":"px-1.5 text-[10px]"} py-0.5 rounded-md bg-sky-400/20 text-sky-100`,children:[a.files,"üìÅ"]})]})]},c+"-"+b)})})]})}function R(d){return d.toISOString().slice(0,10)}function G(){const d=new Date,[r,h]=x.useState(d.getFullYear()),[f,l]=x.useState(d.getMonth()),[m,u]=x.useState(d),[n,v]=x.useState([]),[w,y]=x.useState([]),[g,S]=x.useState(!0),[k,F]=x.useState(()=>{try{return localStorage.getItem("calendar_compact")==="1"}catch{return!1}}),[p,M]=x.useState(()=>{try{return localStorage.getItem("calendar_mode")==="week"?"week":"month"}catch{return"month"}});x.useEffect(()=>{let e=!0;async function a(){try{S(!0);const[s,I]=await Promise.all([O("/api/notes"),O("/api/files")]);if(!e)return;v(s.map(N=>({id:N.id,date:N.date,title:N.title,content:N.text}))),y(I.map(N=>({id:N.id,date:N.date,name:N.name,url:N.url})))}finally{e&&S(!1)}}return a(),()=>{e=!1}},[]);const $=x.useMemo(()=>{const e={};for(const a of n){const s=a.date;e[s]||(e[s]={notes:0,files:0}),e[s].notes++}for(const a of w){const s=a.date;e[s]||(e[s]={notes:0,files:0}),e[s].files++}return e},[n,w]),D=R(m),i=x.useMemo(()=>n.filter(e=>e.date===D),[n,D]),c=x.useMemo(()=>w.filter(e=>e.date===D),[w,D]),o=new Intl.DateTimeFormat("ru-RU",{month:"long"}).format(new Date(r,f,1));function b(){if(p==="week"){const e=new Date(m);e.setDate(e.getDate()-7),u(e),h(e.getFullYear()),l(e.getMonth())}else l(e=>e===0?(h(a=>a-1),11):e-1)}function j(){if(p==="week"){const e=new Date(m);e.setDate(e.getDate()+7),u(e),h(e.getFullYear()),l(e.getMonth())}else l(e=>e===11?(h(a=>a+1),0):e+1)}return t.jsx(E,{children:t.jsxs("div",{className:"mx-auto max-w-6xl px-4 pt-28 pb-20 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("h2",{className:"heading text-2xl sm:text-3xl text-glow",children:"–ö–∞–ª–µ–Ω–¥–∞—Ä—å"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1 glass px-2 py-1 rounded-xl",children:[t.jsx("button",{"aria-label":p==="week"?"–ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è":"–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü",className:"glass-button glass-button--icon focus-ring",onClick:b,children:"‚Üê"}),t.jsxs("div",{className:"px-3 py-1.5 rounded-lg text-sm capitalize text-white/90",children:[o," ",r," –≥."]}),t.jsx("button",{"aria-label":p==="week"?"–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è":"–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü",className:"glass-button glass-button--icon focus-ring",onClick:j,children:"‚Üí"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("button",{className:"glass-button focus-ring",onClick:()=>{const e=new Date;h(e.getFullYear()),l(e.getMonth()),u(e)},children:[t.jsx("span",{className:"hidden sm:inline",children:"–°–µ–≥–æ–¥–Ω—è"}),t.jsx("span",{className:"sm:hidden",children:"–¢"})]}),t.jsxs("button",{className:`glass-button focus-ring ${k?"glass-toggle-active bg-white/10":""}`,"aria-pressed":k,title:k?"–û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥":"–í–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥",onClick:()=>{F(e=>{const a=!e;try{localStorage.setItem("calendar_compact",a?"1":"0")}catch{}return a})},children:[t.jsx("span",{className:"hidden sm:inline",children:"–ö–æ–º–ø–∞–∫—Ç–Ω–æ"}),t.jsx("span",{className:`inline-block size-2 rounded-full ${k?"bg-emerald-400":"bg-white/40"}`,"aria-hidden":!0})]}),t.jsxs("button",{className:`glass-button focus-ring ${p==="week"?"glass-toggle-active bg-white/10":""}`,"aria-pressed":p==="week",title:p==="week"?"–ü–æ–∫–∞–∑–∞—Ç—å –º–µ—Å—è—Ü":"–ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–¥–µ–ª—é",onClick:()=>{M(e=>{const a=e==="week"?"month":"week";try{localStorage.setItem("calendar_mode",a)}catch{}return a})},children:[t.jsx("span",{className:"hidden sm:inline",children:"–ù–µ–¥–µ–ª—è"}),t.jsx("span",{className:"sm:hidden",children:"7–¥"})]})]})]})]}),t.jsx(C,{year:r,month:f,setYear:h,setMonth:l,value:m,onChange:u,countersByDate:$,compact:k,mode:p}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[t.jsxs(A,{children:[t.jsxs("div",{className:"text-sm text-white/60 mb-2",children:["–ó–∞–º–µ—Ç–∫–∏ –Ω–∞ ",D]}),g&&t.jsx("div",{className:"text-white/60",children:"–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"}),!g&&i.length===0&&t.jsx("div",{className:"text-white/50",children:"–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫"}),!g&&i.map(e=>t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"font-medium text-white/90",children:e.title}),e.content&&t.jsx("div",{className:"text-white/70 whitespace-pre-wrap",children:e.content})]},e.id))]}),t.jsxs(A,{children:[t.jsxs("div",{className:"text-sm text-white/60 mb-2",children:["–§–∞–π–ª—ã –Ω–∞ ",D]}),g&&t.jsx("div",{className:"text-white/60",children:"–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"}),!g&&c.length===0&&t.jsx("div",{className:"text-white/50",children:"–ù–µ—Ç —Ñ–∞–π–ª–æ–≤"}),!g&&c.map(e=>t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-white/80 truncate",children:e.name||e.url||"–§–∞–π–ª"}),e.url&&t.jsx("a",{className:"text-accent-200 underline break-all",href:e.url,target:"_blank",rel:"noreferrer",children:"–û—Ç–∫—Ä—ã—Ç—å"})]},e.id))]})]})]})})}export{G as default};
